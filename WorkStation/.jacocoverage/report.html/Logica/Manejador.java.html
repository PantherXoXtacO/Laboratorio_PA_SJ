<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Manejador.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Lab_Pro_Apl&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Logica</a> &gt; <span class="el_source">Manejador.java</span></div><h1>Manejador.java</h1><pre class="source lang-java linenums">package Logica;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.Query;
import DataType.*;


public class Manejador {
    //Clase que conserva las colecciones globales del sistema
    
    private List&lt;Usuario&gt; usuarios;
    private List&lt;Cliente&gt; clientes;
    private List&lt;Artista&gt; artistas;
    private List&lt;ListaDeReproduccion&gt; Listas; // Listas por defecto
<span class="fc" id="L20">    private Genero genero=new Genero(&quot;General&quot;); // Guarda el genero raiz</span>
    private List&lt;Genero&gt; generosList;
    private List&lt;Tema&gt; Temas;//Guarda los temas en una lista
    private List&lt;Album&gt; Albums;
    private Album TemporalAlbum;
    private List&lt;Genero&gt; TemporalGeneros;
    private List&lt;Suscripcion&gt; suscripciones;
    
    //Ids para la identificadores
    private double IdTema;
    private double IdAlbum;
    private double IdList;
    
    //Para la base de datos
<span class="fc" id="L34">    EntityManagerFactory emfactory = Persistence.createEntityManagerFactory( &quot;Lab_Pro_AplPU&quot; );</span>
    
    
<span class="fc" id="L37">    private static Manejador instancia=null;</span>
    
<span class="fc" id="L39">    private Manejador(){</span>
<span class="fc" id="L40">        usuarios =new ArrayList();</span>
<span class="fc" id="L41">        clientes=new ArrayList();</span>
<span class="fc" id="L42">        artistas=new ArrayList();</span>
<span class="fc" id="L43">        Albums = new ArrayList();</span>
<span class="fc" id="L44">        Listas=new ArrayList(); // Listas por defecto</span>
<span class="fc" id="L45">        generosList=new ArrayList();</span>
<span class="fc" id="L46">        Temas=new ArrayList();</span>
<span class="fc" id="L47">        suscripciones = new ArrayList();</span>
<span class="fc" id="L48">        IdTema=0;</span>
<span class="fc" id="L49">        IdAlbum=0;</span>
<span class="fc" id="L50">        IdList=0;</span>
        
<span class="fc" id="L52">        EntityManager entitymanager = emfactory.createEntityManager( );    </span>
<span class="fc" id="L53">        Query q = entitymanager.createQuery(&quot;SELECT a FROM Cliente a&quot;);</span>
<span class="fc" id="L54">        Query q2 = entitymanager.createQuery(&quot;SELECT a FROM Artista a&quot;);</span>
<span class="fc" id="L55">        Query QGeneros = entitymanager.createQuery(&quot;SELECT a FROM Genero a&quot;);</span>
<span class="fc" id="L56">        Query q3 = entitymanager.createQuery(&quot;SELECT a from Album a&quot;);</span>
<span class="fc" id="L57">        Query q4 = entitymanager.createQuery(&quot;SELECT a from Tema a&quot;);</span>
<span class="fc" id="L58">        clientes = q.getResultList();</span>
<span class="fc" id="L59">        artistas = q2.getResultList();</span>
<span class="fc" id="L60">        generosList = QGeneros.getResultList();</span>
<span class="fc" id="L61">        Albums = q3.getResultList();</span>
<span class="fc" id="L62">        Temas = q4.getResultList();</span>
<span class="fc" id="L63">        GeneralGetHijos();</span>
<span class="fc" id="L64">    }</span>
    
    private void GeneralGetHijos(){
<span class="fc" id="L67">        Iterator it = generosList.iterator();</span>
        Genero g;
<span class="fc bfc" id="L69" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L70">            g=(Genero) it.next();</span>
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">            if(g.getPadre().equals(genero.getNombre())){</span>
<span class="fc" id="L72">                genero.addHijo(g);</span>
            }
            else{
<span class="nc" id="L75">                Genero padre = findGenero(g.getPadre());</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">                if(padre!=null){</span>
<span class="nc" id="L77">                    padre.addHijo(g);</span>
                }
<span class="nc" id="L79">            }</span>
        }
<span class="fc" id="L81">    }</span>

    public List&lt;Suscripcion&gt; getSuscripciones() {
<span class="nc" id="L84">        return suscripciones;</span>
    }
    
     public List getAlbumsItem() {
<span class="nc" id="L88">        Iterator it = Albums.iterator();</span>
<span class="nc" id="L89">        List ret= new ArrayList();</span>
        Album L;
<span class="nc bnc" id="L91" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L92">            L= (Album) it.next();</span>
<span class="nc" id="L93">            ret.add(new Item(L,L.getNombre()));</span>
        }
<span class="nc" id="L95">        return ret;</span>
    }
     
     public List getListasItem() {
<span class="nc" id="L99">        Iterator it = Listas.iterator();</span>
<span class="nc" id="L100">        List ret= new ArrayList();</span>
        ListaDeReproduccion L;
<span class="nc bnc" id="L102" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L103">            L= (ListaDeReproduccion) it.next();</span>
<span class="nc" id="L104">            ret.add(new Item(L,L.getNombre()));</span>
        }
<span class="nc" id="L106">        return ret;</span>
    }
    
    public List getTemasItem() {
<span class="nc" id="L110">        Iterator it = Temas.iterator();</span>
<span class="nc" id="L111">        List ret= new ArrayList();</span>
        Tema L;
<span class="nc bnc" id="L113" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L114">            L= (Tema) it.next();</span>
<span class="nc" id="L115">            ret.add(new Item(L,L.getNombre()));</span>
        }
<span class="nc" id="L117">        return ret;</span>
    }
    
    public List&lt;Cliente&gt; getClientes(){
<span class="fc" id="L121">        return this.clientes;        </span>
    }
    
    public List&lt;Artista&gt; getArtistas(){
<span class="fc" id="L125">        return this.artistas;        </span>
    }
    
    public static Manejador getinstance(){
<span class="fc bfc" id="L129" title="All 2 branches covered.">        if (instancia==null)</span>
<span class="fc" id="L130">            instancia = new Manejador();</span>
<span class="fc" id="L131">        return instancia;</span>
    }
    
    public void addCliente(Cliente usu){
<span class="nc" id="L135">        clientes.add(usu);</span>
<span class="nc" id="L136">        EntityManager entitymanager = emfactory.createEntityManager( );  </span>
        try{
<span class="nc" id="L138">            entitymanager.getTransaction().begin();</span>
<span class="nc" id="L139">            entitymanager.persist(usu);</span>
<span class="nc" id="L140">            entitymanager.getTransaction().commit();</span>
<span class="nc" id="L141">            entitymanager.close(); </span>
        }
<span class="nc" id="L143">        catch (Exception e) {</span>
<span class="nc" id="L144">            e.printStackTrace();</span>
<span class="nc" id="L145">            entitymanager.getTransaction().rollback();</span>
<span class="nc" id="L146">        } </span>
<span class="nc" id="L147">    } </span>
    
    public void addArtista(Artista usu){
<span class="nc" id="L150">        artistas.add(usu); </span>
<span class="nc" id="L151">        EntityManager entitymanager = emfactory.createEntityManager( );    </span>
        try {
<span class="nc" id="L153">            entitymanager.getTransaction().begin();</span>
<span class="nc" id="L154">            entitymanager.persist(usu);</span>
<span class="nc" id="L155">            entitymanager.getTransaction().commit();</span>
<span class="nc" id="L156">            entitymanager.close(); </span>
        }
<span class="nc" id="L158">        catch (Exception e) {</span>
<span class="nc" id="L159">            e.printStackTrace();</span>
<span class="nc" id="L160">            entitymanager.getTransaction().rollback();</span>
<span class="nc" id="L161">        } </span>
<span class="nc" id="L162">    }</span>
        
    public boolean nicknameLibre(String nickname){
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if(this.obtenerCliente(nickname) == null){</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">            if(this.obtenerArtista(nickname)== null)</span>
<span class="nc" id="L167">                return true;</span>
        }
<span class="nc" id="L169">        return false;</span>
    }  
    
    public boolean mailLibre(String mail){
<span class="fc bfc" id="L173" title="All 2 branches covered.">        if(this.obtenerClientePorMail(mail) == null){</span>
<span class="pc bpc" id="L174" title="1 of 2 branches missed.">            if(this.obtenerArtistaPorMail(mail)== null)</span>
<span class="fc" id="L175">                return true;</span>
        }
<span class="fc" id="L177">        return false;</span>
    } 
    
    public boolean artistLibre(String nombre){
<span class="fc bfc" id="L181" title="All 2 branches covered.">            if(this.obtenerArtista(nombre)== null)</span>
<span class="fc" id="L182">                return true;</span>
<span class="fc" id="L183">            return false;</span>
    }  
    
   
    public Usuario obtenerClientePorMail(String mail){
<span class="fc" id="L188">        Iterator it = clientes.iterator();</span>
        Cliente user;
<span class="fc bfc" id="L190" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L191">            user = (Cliente)it.next();</span>
<span class="fc bfc" id="L192" title="All 2 branches covered.">            if(user.getMail().equals(mail))</span>
<span class="fc" id="L193">                return user;</span>
        }
<span class="fc" id="L195">        return null;</span>
    }
    public Usuario obtenerArtistaPorMail(String mail){
<span class="fc" id="L198">        Iterator it = artistas.iterator();</span>
        Artista user;
<span class="fc bfc" id="L200" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L201">            user = (Artista)it.next();</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">            if(user.getMail().equals(mail))</span>
<span class="nc" id="L203">                return user;</span>
        }
<span class="fc" id="L205">        return null;</span>
    }
        
    
    public Usuario obtenerUsuario(String nickname){
<span class="nc" id="L210">        Usuario ret = null;</span>
<span class="nc" id="L211">        ret=obtenerCliente(nickname);</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if(ret==null)</span>
<span class="nc" id="L213">            ret=obtenerArtista(nickname);</span>
<span class="nc" id="L214">        return ret;</span>
    }
    
    
    public Cliente obtenerCliente(String nickname){
<span class="fc" id="L219">        Iterator it = clientes.iterator();</span>
        Cliente user;
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">        while(it.hasNext()){</span>
<span class="fc" id="L222">            user = (Cliente)it.next();</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">            if(user.getNickname().equals(nickname))</span>
<span class="fc" id="L224">                return user;</span>
        }
<span class="nc" id="L226">        return null;</span>
    }
    
    public Artista obtenerArtista(String nickname){
<span class="fc" id="L230">        Iterator it = artistas.iterator();</span>
        Artista user;
<span class="fc bfc" id="L232" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L233">            user = (Artista)it.next();</span>
<span class="fc bfc" id="L234" title="All 2 branches covered.">            if(user.getNickname().equals(nickname))</span>
<span class="fc" id="L235">                return user;</span>
        }
<span class="fc" id="L237">        return null;</span>
    }
    
    
    //Funciones auxiliares
    public Genero getGenero(){
<span class="fc" id="L243">        return genero;</span>
    }
    
    public void createTemporalAlbum(){
<span class="fc" id="L247">        this.TemporalAlbum = new Album();</span>
<span class="fc" id="L248">    }</span>
    
    public void deleteTemporalAlbum(){
<span class="fc" id="L251">        this.TemporalAlbum = null;</span>
<span class="fc" id="L252">    }</span>
    
    public Album getTemporalAlbum(){
<span class="fc" id="L255">        return this.TemporalAlbum;</span>
    }
    
    public void setTemporalAlbum(Album album){
<span class="nc" id="L259">        this.TemporalAlbum = album;</span>
<span class="nc" id="L260">    }</span>
    
    public Genero getGeneroPorNombre(String nombre){
<span class="fc" id="L263">        Iterator it = generosList.iterator();</span>
        Genero user;
<span class="fc bfc" id="L265" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L266">            user = (Genero)it.next();</span>
<span class="fc bfc" id="L267" title="All 2 branches covered.">            if(user.getNombre().equals(nombre))</span>
<span class="fc" id="L268">                return user;</span>
        }
<span class="fc" id="L270">        return null;</span>
    }
    
    public ListaParticular getListaPorNombre(Cliente user, String nombre){
<span class="nc" id="L274">        Iterator it = user.getListas().iterator();</span>
        ListaDeReproduccion lista;
<span class="nc bnc" id="L276" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L277">            lista = (ListaDeReproduccion)it.next();</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">            if(lista.getNombre().equals(nombre)){</span>
<span class="nc" id="L279">                ListaParticular listaFinal = (ListaParticular) lista;</span>
<span class="nc" id="L280">                return listaFinal;</span>
            }
        }
<span class="nc" id="L283">        return null;</span>
    }
    
    public List&lt;Genero&gt; getListGeneros(){
<span class="nc" id="L287">        return generosList;</span>
    }

    boolean FindUser(String text) {
<span class="nc" id="L291">        Iterator it=usuarios.iterator();</span>
        Usuario user;
<span class="nc bnc" id="L293" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L294">            user=(Usuario)it.next();</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">            if(user.getNickname().equals(text)){</span>
<span class="nc" id="L296">                return true;</span>
            }
        }
<span class="nc" id="L299">        return false;</span>
    }

    public void persist(Object object) {
<span class="nc" id="L303">        EntityManager entitymanager = emfactory.createEntityManager( );</span>
<span class="nc" id="L304">        entitymanager.getTransaction().begin();</span>
        try {
<span class="nc" id="L306">            entitymanager.persist(object);</span>
<span class="nc" id="L307">            entitymanager.getTransaction().commit();</span>
<span class="nc" id="L308">        } catch (Exception e) {</span>
<span class="nc" id="L309">            e.printStackTrace();</span>
<span class="nc" id="L310">            entitymanager.getTransaction().rollback();</span>
        } finally {
<span class="nc" id="L312">            entitymanager.close();</span>
<span class="nc" id="L313">        }</span>
<span class="nc" id="L314">    }</span>

    public Genero findGenero(String text) {
<span class="fc" id="L317">        Iterator it=generosList.iterator();</span>
        Genero g;
<span class="fc bfc" id="L319" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L320">            g=(Genero)it.next();</span>
<span class="fc bfc" id="L321" title="All 2 branches covered.">            if(g.getNombre().equals(text))</span>
<span class="fc" id="L322">                return g;</span>
        }
<span class="fc" id="L324">        return null;</span>
    }

    void addGeneroToList(Genero nuevoGen){
<span class="fc" id="L328">        EntityManager entitymanager = emfactory.createEntityManager( );    </span>
        try {
<span class="fc" id="L330">            entitymanager.getTransaction().begin();</span>
<span class="fc" id="L331">            entitymanager.persist(nuevoGen);</span>
<span class="fc" id="L332">            entitymanager.getTransaction().commit();</span>
<span class="fc" id="L333">            entitymanager.close(); </span>
        }
<span class="nc" id="L335">        catch (Exception e) {</span>
<span class="nc" id="L336">            e.printStackTrace();</span>
<span class="nc" id="L337">            entitymanager.getTransaction().rollback();</span>
<span class="fc" id="L338">        } </span>
<span class="fc" id="L339">        generosList.add(nuevoGen);</span>
<span class="fc" id="L340">    }</span>
    
    void addListaParticular(Cliente client, String nombreDeLista, String imagenDeLista){
<span class="fc" id="L343">        ListaParticular lista = new ListaParticular(client, nombreDeLista, imagenDeLista);</span>
<span class="fc" id="L344">        client.setListaParticular(lista);</span>
<span class="fc" id="L345">    }</span>
    
    void addListaPorDefecto(Genero genero, String nombreDeLista, String imagenDeLista){
<span class="fc" id="L348">        ListaPorDefecto lista = new ListaPorDefecto(genero, nombreDeLista, imagenDeLista);</span>
<span class="fc" id="L349">        this.Listas.add(lista);</span>
<span class="fc" id="L350">    }</span>
    

    public List ItemCLiente() {
<span class="fc" id="L354">        Iterator it=clientes.iterator();</span>
        Cliente c;
<span class="fc" id="L356">        List ret= new ArrayList();</span>
<span class="fc bfc" id="L357" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L358">            c=(Cliente) it.next();</span>
<span class="fc" id="L359">            ret.add(new Item(c, c.getNickname()));</span>
        }
<span class="fc" id="L361">        return ret;</span>
    }
    
    
    
    public List ItemArtista() {
<span class="nc" id="L367">        Iterator it=artistas.iterator();</span>
        Artista c;
<span class="nc" id="L369">        List ret= new ArrayList();</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L371">            c=(Artista) it.next();</span>
<span class="nc" id="L372">            ret.add(new Item(c, c.getNickname()));</span>
        }
<span class="nc" id="L374">        return ret;</span>
    }

    public List ItemTemas() {
<span class="nc" id="L378">        Iterator it=Temas.iterator();</span>
        Tema t;
<span class="nc" id="L380">        List ret= new ArrayList();</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L382">            t=(Tema)it.next();</span>
<span class="nc" id="L383">            ret.add(new Item(t, t.getNombre()));</span>
        }
<span class="nc" id="L385">        return ret;</span>
    }
    
    public List ItemSuscripciones(){
<span class="nc bnc" id="L389" title="All 2 branches missed.">        if(suscripciones!=null){</span>
<span class="nc" id="L390">            Iterator it = suscripciones.iterator();</span>
            Suscripcion t;
<span class="nc" id="L392">            List ret= new ArrayList();</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">            while(it.hasNext()){</span>
<span class="nc" id="L394">                t=(Suscripcion)it.next();</span>
<span class="nc" id="L395">                ret.add(new Item(t, t.getCliente().getNickname()));</span>
            }
<span class="nc" id="L397">            return ret;    </span>
        }
        else
<span class="nc" id="L400">            return null;</span>
        
    }
    
    public List ItemGenero() {
<span class="fc" id="L405">        Iterator it=generosList.iterator();</span>
        Genero t;
<span class="fc" id="L407">        List ret= new ArrayList();</span>
<span class="fc bfc" id="L408" title="All 2 branches covered.">        while(it.hasNext()){</span>
<span class="fc" id="L409">            t=(Genero)it.next();</span>
<span class="fc" id="L410">            ret.add(new Item(t, t.getNombre()));</span>
        }
<span class="fc" id="L412">        return ret;</span>
    }

    public void updatePersistGen(Genero gen) {
<span class="nc" id="L416">        EntityManager entitymanager = emfactory.createEntityManager( );</span>
<span class="nc" id="L417">        entitymanager.merge(gen);</span>
<span class="nc" id="L418">    }</span>

    public List getListasDefectoItem() {
<span class="nc" id="L421">        Iterator it = Listas.iterator();</span>
<span class="nc" id="L422">        List ret = new ArrayList();</span>
        ListaDeReproduccion lista;
<span class="nc bnc" id="L424" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L425">            lista = (ListaDeReproduccion) it.next();</span>
<span class="nc" id="L426">            ret.add(new Item(lista, lista.getNombre()));</span>
        }
<span class="nc" id="L428">        return ret;</span>
    }
    
    public void configTemporalAlbum(Artista artist, String nombre, List&lt;Genero&gt; generos, int año, String imagePath){
<span class="fc" id="L432">        System.out.println(artist);</span>
<span class="fc" id="L433">        System.out.println(nombre);</span>
<span class="fc" id="L434">        System.out.println(generos);</span>
<span class="fc" id="L435">        System.out.println(año);</span>
<span class="fc" id="L436">        System.out.println(imagePath);</span>
<span class="pc bpc" id="L437" title="1 of 2 branches missed.">        if(artist != null){</span>
<span class="nc" id="L438">            this.TemporalAlbum.setArtista(artist);</span>
<span class="nc" id="L439">            this.TemporalAlbum.setNombre(nombre);</span>
<span class="nc" id="L440">            this.TemporalAlbum.setGenero(generos);</span>
<span class="nc" id="L441">            this.TemporalAlbum.setAnio(año);</span>
<span class="nc" id="L442">            this.TemporalAlbum.setImg(imagePath);    </span>
        }
        
<span class="fc" id="L445">    }</span>
    
    public void addTemporalAlbum(){        
<span class="fc" id="L448">        EntityManager em = emfactory.createEntityManager( );</span>
        try {
<span class="fc" id="L450">            em.getTransaction().begin();</span>
<span class="nc" id="L451">            List&lt;Genero&gt; generos = this.TemporalAlbum.getGeneros();</span>
            
<span class="nc" id="L453">            Artista artist = this.TemporalAlbum.getArtista();</span>
<span class="nc" id="L454">            addAlbumToGeneros(generos, this.TemporalAlbum);</span>
<span class="nc" id="L455">            artist.addAlbum(this.TemporalAlbum); </span>
<span class="nc" id="L456">            this.Albums.add(this.TemporalAlbum);</span>
            
            //em.merge(artist);
            //em.merge(this.TemporalAlbum);
            
<span class="nc" id="L461">            em.getTransaction().commit(); </span>
<span class="nc" id="L462">            em.close();                     </span>
            
        }
<span class="fc" id="L465">        catch (Exception e) {</span>
<span class="fc" id="L466">            e.printStackTrace();</span>
<span class="fc" id="L467">            em.getTransaction().rollback();</span>
<span class="nc" id="L468">        }         </span>
<span class="fc" id="L469">        deleteTemporalAlbum();        </span>
        
<span class="fc" id="L471">    }</span>
    
    public void addAlbumToGeneros(List&lt;Genero&gt; generos, Album album){        
<span class="nc" id="L474">        EntityManager em = emfactory.createEntityManager( );</span>
<span class="nc" id="L475">        Iterator it=generos.iterator();</span>
        Genero g;
<span class="nc bnc" id="L477" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L478">            g=(Genero) it.next();</span>
<span class="nc" id="L479">            g.addAlbum(album);</span>
            try {
<span class="nc" id="L481">            em.getTransaction().begin();</span>
<span class="nc" id="L482">            em.merge(g);            </span>
<span class="nc" id="L483">            em.getTransaction().commit(); </span>
<span class="nc" id="L484">            em.close();  </span>
            }
<span class="nc" id="L486">            catch (Exception e) {</span>
<span class="nc" id="L487">                e.printStackTrace();</span>
<span class="nc" id="L488">                em.getTransaction().rollback();</span>
<span class="nc" id="L489">            }</span>
        }
<span class="nc" id="L491">    }</span>
    
    public void createTemporalGenres(){
<span class="fc" id="L494">        this.TemporalGeneros = new ArrayList();</span>
<span class="fc" id="L495">    }</span>
    
    public void addToTemporalGenres(Genero genero){
<span class="pc bpc" id="L498" title="1 of 2 branches missed.">        if(genero != null){</span>
<span class="nc" id="L499">            this.TemporalGeneros.add(genero);</span>
        }
        
<span class="fc" id="L502">    }</span>
    
    public void wipeTemporalGenres(){
<span class="fc" id="L505">        this.TemporalGeneros = null;</span>
<span class="fc" id="L506">    }</span>
    
    public List&lt;Genero&gt; getTemporalGenres(){
<span class="fc" id="L509">        return this.TemporalGeneros;</span>
    }
    
    public void addAlbum(Album album){
<span class="nc" id="L513">        this.Albums.add(album);</span>
<span class="nc" id="L514">    }</span>
    
    public void addTema(Tema tema){
<span class="fc" id="L517">        this.Temas.add(tema);</span>
<span class="fc" id="L518">        EntityManager em = emfactory.createEntityManager( );</span>
        try {
<span class="fc" id="L520">            em.getTransaction().begin();</span>
<span class="nc" id="L521">            em.merge(tema);            </span>
<span class="nc" id="L522">            em.getTransaction().commit(); </span>
<span class="nc" id="L523">            em.close();  </span>
        }
<span class="fc" id="L525">        catch (Exception e) {</span>
<span class="fc" id="L526">            e.printStackTrace();</span>
<span class="fc" id="L527">            em.getTransaction().rollback();</span>
<span class="nc" id="L528">        }</span>
<span class="fc" id="L529">    }</span>

    public List getAllListsAsItem() {
<span class="nc" id="L532">        List ret = new ArrayList();</span>
<span class="nc" id="L533">        Iterator itC = clientes.iterator();</span>
        Cliente c;
<span class="nc bnc" id="L535" title="All 2 branches missed.">        while(itC.hasNext()){</span>
<span class="nc" id="L536">            c=(Cliente) itC.next();</span>
<span class="nc" id="L537">            ret.addAll(c.getListasPublicas());</span>
        }
<span class="nc" id="L539">        ret.addAll(this.getListasDefectoItem());        </span>
<span class="nc" id="L540">        return ret;</span>
    }    
    
    boolean ClienteNickRepetido(String nick) {
<span class="fc" id="L544">        Iterator it = clientes.iterator();</span>
        Cliente c;
<span class="pc bpc" id="L546" title="1 of 2 branches missed.">        while(it.hasNext()){</span>
<span class="fc" id="L547">            c=(Cliente) it.next();</span>
<span class="fc bfc" id="L548" title="All 2 branches covered.">            if(nick.equals(c.getNickname())){</span>
<span class="fc" id="L549">                return true;</span>
            }
        }
<span class="nc" id="L552">        return false;</span>
    }
    
    boolean ArtistaNickRepetido(String nick) {
<span class="fc" id="L556">        Iterator it = artistas.iterator();</span>
        Artista a;
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">        while(it.hasNext()){</span>
<span class="fc" id="L559">            a=(Artista) it.next();</span>
<span class="fc bfc" id="L560" title="All 2 branches covered.">            if(nick.equals(a.getNickname())){</span>
<span class="fc" id="L561">                return true;</span>
            }
        }
<span class="nc" id="L564">        return false;</span>
    }
    
    boolean ClienteMailRepetido(String mail) {
<span class="nc" id="L568">        Iterator it = clientes.iterator();</span>
        Cliente c;
<span class="nc bnc" id="L570" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L571">            c=(Cliente) it.next();</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">            if(mail.equals(c.getMail())){</span>
<span class="nc" id="L573">                return true;</span>
            }
        }
<span class="nc" id="L576">        return false;</span>
    }
    
    boolean ArtistaMailRepetido(String mail) {
<span class="nc" id="L580">        Iterator it = artistas.iterator();</span>
        Artista a;
<span class="nc bnc" id="L582" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L583">            a=(Artista) it.next();</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">            if(mail.equals(a.getMail())){</span>
<span class="nc" id="L585">                return true;</span>
            }
        }
<span class="nc" id="L588">        return false;</span>
    }

    
    public void ActualizarUsuario(Usuario u){
<span class="nc" id="L593">        EntityManager em = emfactory.createEntityManager();        </span>
            try{
<span class="nc bnc" id="L595" title="All 2 branches missed.">                if(u instanceof Cliente){</span>
<span class="nc" id="L596">                    em.getTransaction().begin();</span>
<span class="nc" id="L597">                    em.merge((Cliente)u);</span>
<span class="nc" id="L598">                    em.getTransaction().commit(); </span>
<span class="nc" id="L599">                    em.close();</span>
                }
                else{
<span class="nc" id="L602">                    em.getTransaction().begin();</span>
<span class="nc" id="L603">                    em.merge((Artista)u);</span>
<span class="nc" id="L604">                    em.getTransaction().commit(); </span>
<span class="nc" id="L605">                    em.close();</span>
                }
            }
<span class="nc" id="L608">            catch(Exception e){</span>
<span class="nc" id="L609">                e.printStackTrace();</span>
<span class="nc" id="L610">                em.getTransaction().rollback();</span>
<span class="nc" id="L611">            }</span>
<span class="nc" id="L612">    }</span>

/////////////////////////////////////FUNCIONES DE SERVLET//////////////////////////////////////////////



    public DTUsuario getUserData(String identificador) {
<span class="nc" id="L619">        DTUsuario ret = null;</span>
        Cliente c;
<span class="nc" id="L621">        Iterator it = clientes.iterator();</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L623">            c=(Cliente) it.next();</span>
<span class="nc bnc" id="L624" title="All 4 branches missed.">            if(c.getNickname().equals(identificador) || c.getMail().equals(identificador)){</span>
<span class="nc" id="L625">                ret=new DTCliente(c);</span>
<span class="nc" id="L626">                break;</span>
            }            
        }        
<span class="nc bnc" id="L629" title="All 2 branches missed.">        if(ret==null){</span>
            Artista a;
<span class="nc" id="L631">            Iterator itArt = artistas.iterator();</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">            while(itArt.hasNext()){</span>
<span class="nc" id="L633">                a=(Artista) itArt.next();</span>
<span class="nc bnc" id="L634" title="All 4 branches missed.">                if(a.getNickname().equals(identificador) || a.getMail().equals(identificador)){</span>
<span class="nc" id="L635">                    ret=new DTArtista(a);</span>
<span class="nc" id="L636">                    break;</span>
                }
            }
        }        
<span class="nc" id="L640">        return ret;</span>
    }

    public DataSession getUserSession(String identificador, String pass) {
<span class="nc" id="L644">        DataSession ret = null;</span>
        Usuario u;
<span class="nc" id="L646">        Iterator it=clientes.iterator();</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L648">            u=(Usuario) it.next();</span>
<span class="nc bnc" id="L649" title="All 6 branches missed.">            if((u.getNickname().equals(identificador) || u.getMail().equals(identificador)) &amp;&amp; (u.getContraseña().equals(pass))){</span>
<span class="nc" id="L650">                ret=u.getSession();</span>
<span class="nc" id="L651">                break;</span>
            }
        }
<span class="nc bnc" id="L654" title="All 2 branches missed.">        if(ret==null){</span>
<span class="nc" id="L655">            Iterator itArt = artistas.iterator();</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">            while(itArt.hasNext()){</span>
<span class="nc" id="L657">                u=(Usuario) itArt.next();</span>
<span class="nc bnc" id="L658" title="All 6 branches missed.">                if((u.getNickname().equals(identificador) || u.getMail().equals(identificador)) &amp;&amp; (u.getContraseña().equals(pass))){</span>
<span class="nc" id="L659">                    ret=u.getSession();</span>
<span class="nc" id="L660">                    break;</span>
                }
            }
        }
<span class="nc" id="L664">        return ret;</span>
    }
    
    public void addSuscripcion(Cliente cliente, Suscripcion s){       
<span class="nc" id="L668">        EntityManager em = emfactory.createEntityManager( );</span>
        
            
<span class="nc bnc" id="L671" title="All 4 branches missed.">        if(cliente!=null &amp;&amp; s!=null){</span>
<span class="nc" id="L672">            cliente.setSuscripcion(s);</span>
<span class="nc" id="L673">            suscripciones.add(s);        </span>
<span class="nc" id="L674">            em.getTransaction().begin();</span>
<span class="nc" id="L675">            em.merge(s);</span>
<span class="nc" id="L676">            em.merge(cliente);</span>
<span class="nc" id="L677">            em.getTransaction().commit();</span>
<span class="nc" id="L678">            em.close();      </span>
        }
       
        
<span class="nc" id="L682">    }</span>

    void AgregarTemaListaWeb(String user, String lista, String artista, String album, String tema) {
<span class="nc" id="L685">        Iterator itArt = artistas.iterator();</span>
        Artista a;
<span class="nc" id="L687">        Tema t=null;</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">        while(itArt.hasNext()){</span>
<span class="nc" id="L689">            a=(Artista) itArt.next();</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">            if(a.getNickname().equals(artista)){</span>
<span class="nc" id="L691">                t=a.getTema(album, tema);</span>
<span class="nc" id="L692">                break;</span>
            }
        }
<span class="nc" id="L695">        Iterator itC = clientes.iterator();</span>
        Cliente c;
<span class="nc bnc" id="L697" title="All 2 branches missed.">        while(itC.hasNext()){</span>
<span class="nc" id="L698">            c=(Cliente) itC.next();</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if(c.getNickname().equals(user)){</span>
<span class="nc" id="L700">                c.AgregarTemaLista(lista, t);</span>
<span class="nc" id="L701">                break;</span>
            }
        }
<span class="nc" id="L704">    }</span>

    void ActualizarImagenUsuario(String UserNick, String path) {
<span class="nc" id="L707">        Iterator itC = clientes.iterator();</span>
        Cliente c;
<span class="nc bnc" id="L709" title="All 2 branches missed.">        while(itC.hasNext()){</span>
<span class="nc" id="L710">            c=(Cliente) itC.next();</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">            if(c.getNickname().equals(UserNick)){</span>
<span class="nc" id="L712">                c.setImagen(path);</span>
<span class="nc" id="L713">                return;</span>
            }
        }
        
<span class="nc" id="L717">        Iterator itA = artistas.iterator();</span>
        Artista a;
<span class="nc bnc" id="L719" title="All 2 branches missed.">        while(itA.hasNext()){</span>
<span class="nc" id="L720">            a=(Artista) itA.next();</span>
<span class="nc bnc" id="L721" title="All 2 branches missed.">            if(a.getNickname().equals(UserNick)){</span>
<span class="nc" id="L722">                a.setImagen(path);</span>
<span class="nc" id="L723">                return;</span>
            }
        }        
<span class="nc" id="L726">    }</span>
    
    void ActualizarImagenAlbum(String AlbumNombre, String path) {
<span class="nc" id="L729">        Iterator itC = Albums.iterator();</span>
        Album c;
<span class="nc bnc" id="L731" title="All 2 branches missed.">        while(itC.hasNext()){</span>
<span class="nc" id="L732">            c=(Album) itC.next();</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">            if(c.getNombre().equals(AlbumNombre)){</span>
<span class="nc" id="L734">                c.setImg(path);</span>
<span class="nc" id="L735">                return;</span>
            }
        }
<span class="nc" id="L738">    }</span>
    
      public List&lt;Album&gt; getAlbumList(){
<span class="nc" id="L741">        return this.Albums;</span>
    }
    
    Album getAlbumByName(String albunname) {
<span class="nc" id="L745">        Iterator it = Albums.iterator();</span>
        Album a;
<span class="nc bnc" id="L747" title="All 2 branches missed.">        while(it.hasNext()){</span>
<span class="nc" id="L748">            a=(Album) it.next();</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">            if(a.getNombre().equals(albunname)){</span>
<span class="nc" id="L750">                return a;</span>
            }
        }
<span class="nc" id="L753">        return null;        </span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>